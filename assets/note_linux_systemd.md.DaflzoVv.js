import{_ as s,c as i,o as a,a4 as e}from"./chunks/framework.4aTu-Nia.js";const y=JSON.parse('{"title":"Systemd","description":"","frontmatter":{},"headers":[],"relativePath":"note/linux/systemd.md","filePath":"note/linux/systemd.md"}'),t={name:"note/linux/systemd.md"},l=e(`<h1 id="systemd" tabindex="-1">Systemd <a class="header-anchor" href="#systemd" aria-label="Permalink to &quot;Systemd&quot;">​</a></h1><h3 id="相关的路径" tabindex="-1">相关的路径 <a class="header-anchor" href="#相关的路径" aria-label="Permalink to &quot;相关的路径&quot;">​</a></h3><ul><li><code>/etc/systemd/system/*</code> - 供系统管理员和用户使用</li><li><code>/run/systemd/system/*</code> - 运行时配置文件</li><li><code>/usr/lib/systemd/system/*</code> - 安装程序使用</li></ul><h3 id="基本命令" tabindex="-1">基本命令 <a class="header-anchor" href="#基本命令" aria-label="Permalink to &quot;基本命令&quot;">​</a></h3><ul><li>显示状态：<code>systemctl status</code></li><li>显示激活的单元：<code>systemctl / systemctl list-units</code></li><li>控制与状态相关：<code>systemctl start/stop/reload/status &lt;单元&gt;</code></li><li>开机启动相关：<code>systemctl is-enabled/enable/disable &lt;单元&gt;</code></li><li>禁用与恢复：<code>systemctl mask/unmask &lt;单元&gt;</code></li><li>显示帮助：<code>systemctl help &lt;单元&gt;</code></li><li>重载 Systemd：<code>systemctl daemon-reload</code></li></ul><h3 id="单元文件内容" tabindex="-1">单元文件内容 <a class="header-anchor" href="#单元文件内容" aria-label="Permalink to &quot;单元文件内容&quot;">​</a></h3><p>一个Systemd Service的服务配置文件大概长这样：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Description</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> some</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> descriptions</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Documentation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> man:xxx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">man:xxx_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Requires</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx1.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx2.target</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">After</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yyy1.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yyy2.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TYP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecStart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CMD_for_STAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecStop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CMD_for_STO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecReload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CMD_for_RELOA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WHEN_TO_RESTAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RestartSec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WantedBy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yy.target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>一个 <code>.Service</code> 配置文件分为三部分：</p><ul><li><strong>Unit</strong>：定义该服务作为Unit角色时相关的属性</li><li><strong>Service</strong>：定义本服务相关的属性</li><li><strong>Install</strong>：定义本服务在设置服务开机自启动时相关的属性。换句话说，只有在创建/移除服务配置文件的软链接时，Install 段才会派上用场。这一配置段不是必须的，当未配置 [Install] 时，设置开机自启动或禁止开机自启动的操作将无任何效果</li></ul><h4 id="unit-记录unit文件的通用信息" tabindex="-1"><code>[Unit]</code> - 记录unit文件的通用信息 <a class="header-anchor" href="#unit-记录unit文件的通用信息" aria-label="Permalink to &quot;\`[Unit]\` - 记录unit文件的通用信息&quot;">​</a></h4><ul><li><code>Description</code>： 描述内容</li><li><code>Requires</code>： 依赖的服务，若选择单元未启动，则本单元启动失败</li><li><code>Wants</code>： 依赖的服务，但选择单元未启动，对本单元无影响</li><li><code>After</code> / <code>Before</code>： 定义启动顺序</li></ul><h4 id="service-记录-service-的信息" tabindex="-1"><code>[Service]</code> - 记录 <a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html" target="_blank" rel="noreferrer">Service</a> 的信息 <a class="header-anchor" href="#service-记录-service-的信息" aria-label="Permalink to &quot;\`[Service]\` - 记录 [Service](https://www.freedesktop.org/software/systemd/man/systemd.service.html) 的信息&quot;">​</a></h4><ul><li><code>Type</code>： 服务启动方式</li><li><code>User</code> / <code>Group</code>： 用户/用户组</li><li><code>ExecStart</code> ： 启动时执行的命令</li><li><code>ExecStartPre</code>, <code>ExecStartPost</code>: ExecStart执行前后所调用的命令。</li><li><code>ExecStop</code>: 定义停止服务时所执行的命令，定义服务退出前所做的处理。如果没有指定，使用systemctl stop xxx命令时，服务将立即被终结而不做处理。</li><li><code>Restart</code>: 定义服务何种情况下重启（启动失败，启动超时，进程被终结）。可选选项：no, on-success, on-failure,on-watchdog, on-abort</li></ul><h4 id="install-安装信息" tabindex="-1"><code>[Install]</code> - 安装信息 <a class="header-anchor" href="#install-安装信息" aria-label="Permalink to &quot;\`[Install]\` - 安装信息&quot;">​</a></h4><ul><li><code>WantedBy</code>： 何种情况下，服务被启用。<code>WantedBy=multi-user.target</code> （多用户环境下启用）</li><li><code>Alias</code>： 别名</li></ul><h4 id="ref" tabindex="-1">Ref: <a class="header-anchor" href="#ref" aria-label="Permalink to &quot;Ref:&quot;">​</a></h4><ul><li><a href="https://wiki.archlinux.org/index.php/systemd" target="_blank" rel="noreferrer">Archwiki - Systemd</a></li><li><a href="http://blog.csdn.net/fu_wayne/article/details/38018825" target="_blank" rel="noreferrer">编写systemd下服务脚本</a></li><li><a href="https://patrakov.blogspot.com/2011/01/writing-systemd-service-files.html" target="_blank" rel="noreferrer">Writing systemd service files</a></li><li><a href="https://systemd-book.junmajinlong.com/service_1.html" target="_blank" rel="noreferrer">Systemd系列文章</a></li></ul>`,18),n=[l];function r(h,p,k,d,c,o){return a(),i("div",null,n)}const g=s(t,[["render",r]]);export{y as __pageData,g as default};
